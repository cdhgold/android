package com.example.sendmulti;

import androidx.appcompat.app.AppCompatActivity;

import android.graphics.Bitmap;
import android.graphics.drawable.BitmapDrawable;
import android.os.Bundle;
import android.os.Environment;
import android.widget.ImageView;

import com.androidnetworking.AndroidNetworking;
import com.androidnetworking.common.Priority;
import com.androidnetworking.error.ANError;
import com.androidnetworking.interfaces.JSONObjectRequestListener;

import org.json.JSONObject;

import java.io.File;
import java.io.FileOutputStream;
import java.io.OutputStream;

public class MainActivity extends AppCompatActivity {
    private ImageView carImg01;
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        carImg01 = (ImageView)findViewById(R.id.carImg01);
        Bitmap bitmap = ((BitmapDrawable)carImg01.getDrawable()).getBitmap();

        try {
            File filePath = new File(Environment.getRootDirectory()+"/car/"   );
            if(!filePath.exists()){
                filePath.mkdirs();
            }
            //file.createNewFile();
            File file  = new File(getApplicationContext().getFilesDir()+"/carImg01.jpg"   );

            OutputStream out = new FileOutputStream(file);
            bitmap.compress(Bitmap.CompressFormat.JPEG, 100, out);
            Send send  = new Send(file);
            send.start( );

            out.close();
        } catch (Exception e) {

            e.printStackTrace();

        } finally {

            try {

            } catch ( Exception e) {
                e.printStackTrace();
            }
        }


    }


    class Send  extends Thread{
        public File file;
        public Send(File f){
            this.file = f;

        }
        @Override
        public void run() {
            // tag 인식속성
            // AndroidNetworking.forceCancel("tag"); // 취소시
            //


            AndroidNetworking.post("http://konginfo.co.kr/car/carIns/save")
                    .addBodyParameter("carNm", "cdhgold")
                    .addBodyParameter("carAmt", "1000")
                   // .addFileBody(file) // posting any type of file
                    .setTag("campCar")
                    .setPriority(Priority.MEDIUM)
                    .build()
                    .getAsJSONObject(new JSONObjectRequestListener() {
                        @Override
                        public void onResponse(JSONObject response) {
                            System.out.println("car=>"+response);
                        }
                        @Override
                        public void onError(ANError error) {
                            // handle error
                            System.out.println("car=>"+error);
                        }
                    });
        }
    }
}
